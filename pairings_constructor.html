<!DOCTYPE html>
	<html lang="en">
		<head>
			<title>
				Double Elimination Pairings Constructor
			</title>
			<style>
				body {
					background: radial-gradient(circle, rgba(244,202,46,1) 33%, rgba(240,168,31,1) 66%, rgba(252,131,7,0.9971698151917017) 100%);
					text-align: center;
					font-family: georgia;
				}
				a:link {
					color: #0000EE;
				}
				a:visited {
					color: #0000EE;
				}
				h1 {
					text-decoration: underline;
				}
				h4 {
					line-height: 0;
					margin-top: 10px;
					margin-bottom: 10px;
					text-align: center;
					font-size: 13px;
				}
				label {
					font-weight: bold;
				}
				button {
					margin-top: 10px;
					margin-left: 20px;
					font-weight: bold;
					width: 400px;
				}
				.no-fouc {
					display: none;
				}
				.div-inline {
					display:inline-block;
					margin-top: 10px;
				}
				.tarea {
					resize: none;
					border : 2px solid black;
					height: 70px;
					margin-right: 20px;
					margin-top: 2px;
					text-align: center;
					padding: 5px;
					font-size: 12px;
				}
				.small {
					font-size: 12px;
				}
				#round {
					width: 50px;
				}
				#output {
					border: 3px solid black;
					height: 130px;
				}
				#empty {
					width: 60px;
					padding: 0px;
					margin-left: 10px;
					font-size: 11px;
				}
			</style>
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
			<script>
				document.documentElement.className = 'no-fouc';
				$(document).ready(function() {
					startUp();
					$('.no-fouc').removeClass('no-fouc');
				});
				function startUp () {
					
					// Declaring variables.
					var theme = "", multiplier = "", size = "", 
					    round = "", parity = "", method = "", 
					    topleft = "", topright = "", 
					    botleft = "", botright = "",
					    output = "", reverse = "", atOn = "";
					
					// Assigning stored variables
					theme = localStorage.getItem("theme");
					multiplier = localStorage.getItem("multiplier");
					size = localStorage.getItem("size");
					parity = localStorage.getItem("parity");
					round = localStorage.getItem("round");
					method = localStorage.getItem("method");
					topleft = localStorage.getItem("top-left");
					topright = localStorage.getItem("top-right");
					botleft = localStorage.getItem("bottom-left");
					botright = localStorage.getItem("bottom-right");
					output = localStorage.getItem("output");
					atOn = localStorage.getItem("@on");
					reverse = localStorage.getItem("reverse");
					
					// Setting stored defaults.
					
					if (theme === "DeepDark" || theme === "IceBlue" || theme === "MalachtiteGreen" || theme === "PhloxPurple" || theme === "ScarletRed" || theme === "StandardSilver") {
						document.getElementById("themechange").value = theme;
						changeTheme(theme);
					}
					if (multiplier === "1.5") {
						document.getElementById("scaler").options.selectedIndex = 1;
						scale(multiplier);
					}
					if (size === "8" || size === "16" || size === "32" || size === "128" || size === "256" || size === "512"){
						document.getElementById("size").value = size;
						modifySize(size);
					}
					if (parity === "odd") {
						document.getElementById("parity").options.selectedIndex = 1;
						changeParity(parity);
					}
					if (round === "4" || round === "6" || round === "8" || round === "10" || round === "12" || round === "14") {
						document.getElementById("round").value = round;
					}
					if (method === "Stack") {
						document.getElementById("method").options.selectedIndex = 0;
					}
					if (topleft !== null) {
						tidy("top-left", topleft);
					}
					if (topright !== null) {
						tidy("top-right", topright);
					}
					if (botleft !== null) {
						tidy("bottom-left", botleft);
					}
					if (botright !== null) {
						tidy("bottom-right", botright);
					}
					if (output !== null) {
						tidy("output", output);
					}
					if (atOn === "false") {
						document.getElementById("@on").checked = false;
						atSave();	
					}
					if (reverse === "true") {
						document.getElementById("reverse").checked = true;
						reversal();
					}
				}
				function changeTheme(selected) {
					// Declaring variables.
					var gradients = {}, tarea = {}, element = {};

					// Assigning variables.
					gradients = {
						DeepDark: "radial-gradient(circle, rgba(56,56,56,1) 33%, rgba(33,33,33,1) 66%, rgba(0,0,0,0.9971698151917017) 100%)",
						IceBlue: "radial-gradient(circle, rgba(204,247,247,1) 33%, rgba(111,215,219,1) 66%, rgba(107,180,184,0.9971698151917017) 100%)",
						MalachtiteGreen: "radial-gradient(circle, rgba(183,240,166,1) 33%, rgba(128,255,100,1) 66%, rgba(15,194,2,0.9971698151917017) 100%)",
						PhloxPurple: "radial-gradient(circle, rgba(237,168,234,1) 33%, rgba(207,9,244,1) 66%, rgba(231,6,250,0.9971698151917017) 100%)",
						ScarletRed: "radial-gradient(circle, rgba(245,127,127,1) 33%, rgba(255,68,5,1) 66%, rgba(204,37,4,0.9971698151917017) 100%)",
						StandardSilver: "radial-gradient(circle, rgba(217,215,215,1) 33%, rgba(148,147,147,1) 66%, rgba(140,136,140,0.9971698151917017) 100%)",
						SunnyOrange: "radial-gradient(circle, rgba(244,202,46,1) 33%, rgba(240,168,31,1) 66%, rgba(252,131,7,0.9971698151917017) 100%)"
					};
					tarea = document.getElementsByClassName("tarea");
					document.body.style.background = gradients[selected];
						if (selected === "DeepDark"){
							document.body.style.color = "white";
							document.getElementById("home").style.color = "#35fcf2";
							for (element of tarea) {
								element.style.background = "black";
								element.style.color = "white";
								element.style.border = (element.id === "output") ? "3px solid white" : "2px solid white";
							}
						}
						else {
							document.body.style.color = "black";
							document.getElementById("home").style.color = "#0000EE";
							for (element of tarea) {
								element.style.background = "white";
								element.style.color = "black";
								element.style.border = (element.id === "output") ? "3px solid black" : "2px solid black";
							}
						}
					
						// saving theme for retrieval
						localStorage.setItem("theme", selected);
				}
				function atSave () {
					var atOn = document.getElementById("@on").checked;
					
					// saving @ on/off boolean for retrieval
					localStorage.setItem("@on", atOn);
				}
				function reversal () {
					var isReverse = document.getElementById("reverse").checked;
					
					// saving checkbox boolean for retrieval
					localStorage.setItem("reverse", isReverse);
					
					if (isReverse){
						document.getElementById("button").innerHTML = "De-Construct Pairings";
						document.getElementById("top-left").readOnly = true;
						document.getElementById("top-left").placeholder = "De-merged output will be displayed here.";
						document.getElementById("top-right").readOnly = true;
						document.getElementById("top-right").placeholder = "De-merged output will be displayed here.";
						document.getElementById("bottom-left").readOnly = true;
						document.getElementById("bottom-left").placeholder = "De-merged output will be displayed here.";
						document.getElementById("bottom-right").readOnly = true;
						document.getElementById("bottom-right").placeholder = "De-merged output will be displayed here.";
						document.getElementById("output").readOnly = false;
						document.getElementById("output").placeholder = "Copy and paste previously merged output here.";
						return;
					}
					document.getElementById("button").innerHTML = "Construct Pairings";
					document.getElementById("top-left").readOnly = false;
					document.getElementById("top-left").placeholder = "Copy and paste text from the bracketmaker directly.";
					document.getElementById("top-right").readOnly = false;
					document.getElementById("top-right").placeholder = "Copy and paste text from the bracketmaker directly.";
					document.getElementById("bottom-left").readOnly = false;
					document.getElementById("bottom-left").placeholder = "Copy and paste text from the bracketmaker directly.";
					document.getElementById("bottom-right").readOnly = false;
					document.getElementById("bottom-right").placeholder = "Copy and paste text from the bracketmaker directly.";
					document.getElementById("output").readOnly = true;
					document.getElementById("output").placeholder = "Merged output will be displayed here.";
				}
				function scale (multiplier) {
					
					// saving multiplier for retrieval
					localStorage.setItem("multiplier", multiplier);
					
					if (multiplier === "1.5") {
						document.getElementById("8").innerHTML = "12";
						document.getElementById("16").innerHTML = "24";
						document.getElementById("32").innerHTML = "48";
						document.getElementById("64").innerHTML = "96";
						document.getElementById("128").innerHTML = "192";
						document.getElementById("256").innerHTML = "384";
						document.getElementById("512").innerHTML = "768";
						return;
					}
					document.getElementById("8").innerHTML = "8";
					document.getElementById("16").innerHTML = "16";
					document.getElementById("32").innerHTML = "32";
					document.getElementById("64").innerHTML = "64";
					document.getElementById("128").innerHTML = "128";
					document.getElementById("256").innerHTML = "256";
					document.getElementById("512").innerHTML = "512";
				}
				function modifySize (size) {
					var round = 0, currentRoundIndex = 0, maxRoundIndex = 0, parityIndex = 0;
					currentRoundIndex = document.getElementById("round").options.selectedIndex;
					maxRoundIndex = (Math.log2(parseInt(size)) - 3);
					parityIndex = document.getElementById("parity").options.selectedIndex;
					if (currentRoundIndex > maxRoundIndex){
						currentRoundIndex = maxRoundIndex;
						round = (maxRoundIndex+1)*2;
						saveRound(round);
					}
					if (parityIndex === 0){
						document.getElementById("round").innerHTML = '<option id="2" value="2">2</option>';
						if (size > parseInt("12")) {
							document.getElementById("round").innerHTML += '<option id="4" value="4">4</option>';
						}
						if (size > parseInt("24")) {
							document.getElementById("round").innerHTML += '<option id="6" value="6">6</option>';
						}
						if (size > parseInt("48")) {
							document.getElementById("round").innerHTML += '<option id="1000" value="8">8</option>';
						}
						if (size > parseInt("96")) {
							document.getElementById("round").innerHTML += '<option id="10" value="10">10</option>';
						}
						if (size > parseInt("192")) {
							document.getElementById("round").innerHTML += '<option id="12" value="12">12</option>';
						}
						if (size > parseInt("384")) {
							document.getElementById("round").innerHTML += '<option id="14" value="14">14</option>';
						}
					}
					if (parityIndex === 1){
						document.getElementById("round").innerHTML = '<option id="2" value="2">3</option>';
						if (size > parseInt("12")) {
							document.getElementById("round").innerHTML += '<option id="4" value="4">5</option>';
						}
						if (size > parseInt("24")) {
							document.getElementById("round").innerHTML += '<option id="6" value="6">7</option>';
						}
						if (size > parseInt("48")) {
							document.getElementById("round").innerHTML += '<option id="1000" value="8">9</option>';
						}
						if (size > parseInt("96")) {
							document.getElementById("round").innerHTML += '<option id="10" value="10">11</option>';
						}
						if (size > parseInt("192")) {
							document.getElementById("round").innerHTML += '<option id="12" value="12">13</option>';
						}
						if (size > parseInt("384")) {
							document.getElementById("round").innerHTML += '<option id="14" value="14">15</option>';
						}
					}
					document.getElementById("round").options.selectedIndex = currentRoundIndex;
					// saving size for retrieval
					localStorage.setItem("size", size);
				}
				function changeParity (parity) {
					var lastIndex = document.getElementById("round").options.length-1;
					// saving parity for retrieval
					localStorage.setItem("parity", parity);
					if (parity === "odd") {
						document.getElementById("2").innerHTML = "3";
						if (document.getElementById("4") !== null) {
							if (document.getElementById("4").innerHTML === "4") {
								document.getElementById("4").innerHTML = "5";
							}
						}
						if (document.getElementById("6") !== null) {
							if (document.getElementById("6").innerHTML  === "6") {
								document.getElementById("6").innerHTML = "7";
							}
						}
						if (document.getElementById("1000") !== null) {
							if (document.getElementById("1000").innerHTML  === "8") {
								document.getElementById("1000").innerHTML = "9";
							}
						}
						if (document.getElementById("10") !== null) {
							if (document.getElementById("10").innerHTML  === "10") {
								document.getElementById("10").innerHTML = "11";
							}
						}
						if (document.getElementById("12") !== null) {
							if (document.getElementById("12").innerHTML  === "12") {
								document.getElementById("12").innerHTML = "13";
							}
						}
						if (document.getElementById("14") !== null) {
							if (document.getElementById("14").innerHTML  === "14") {
								document.getElementById("14").innerHTML = "15";
							}
						}
						document.getElementById("W1").innerHTML = document.getElementById("W1").innerHTML.replace("<small>Winners</small>","<small>Losers</small>");
						document.getElementById("W2").innerHTML = document.getElementById("W2").innerHTML.replace("<small>Winners</small>","<small>Losers</small>");
						return;
					}
					if (document.getElementById("round").options.selectedIndex !== lastIndex){
						document.getElementById("round").options.selectedIndex++;
					}
					document.getElementById("2").innerHTML = "2";
					if (document.getElementById("4") !== null) {
						if (document.getElementById("4").innerHTML === "5") {
							document.getElementById("4").innerHTML = "4";
						}
					}
					if (document.getElementById("6") !== null) {
						if (document.getElementById("6").innerHTML  === "7") {
							document.getElementById("6").innerHTML = "6";
						}
					}
					if (document.getElementById("1000") !== null) {
						if (document.getElementById("1000").innerHTML  === "9") {
							document.getElementById("1000").innerHTML = "8";
						}
					}
					if (document.getElementById("10") !== null) {
						if (document.getElementById("10").innerHTML  === "11") {
							document.getElementById("10").innerHTML = "10";
						}
					}
					if (document.getElementById("12") !== null) {
						if (document.getElementById("12").innerHTML  === "13") {
							document.getElementById("12").innerHTML = "12";
						}
					}
					if (document.getElementById("14") !== null) {
						if (document.getElementById("14").innerHTML  === "15") {
							document.getElementById("14").innerHTML = "14";
						}
					}
					document.getElementById("W1").innerHTML = document.getElementById("W1").innerHTML.replace("<small>Losers</small>","<small>Winners</small>");
					document.getElementById("W2").innerHTML = document.getElementById("W2").innerHTML.replace("<small>Losers</small>","<small>Winners</small>");
				}
				function saveRound (round) {
					// saving round number for retrieval
					localStorage.setItem("round", round);
				}
				function saveMethod (method) {
					// saving size for retrieval
					localStorage.setItem("method", method);
				}
				function tidy (name, text) {
					var newtext = "", linecount = 0, charcount = 0;
					newtext = text.replace(/\n\n/g,"\n").replace(/^\n/,"");
					document.getElementById(name).value = newtext;
					charcount = newtext.length;
					linecount = newtext.split("\n").length;
					linecount -= newtext.slice("-1") === "\n";
					linecount -= charcount === 0;
					if (name === "top-left") {
						document.getElementById("W1").innerHTML = document.getElementById("W1").innerHTML.replace(/\[\d+\//,"["+linecount+"/");	
					}
					if (name === "top-right") {
						document.getElementById("W2").innerHTML = document.getElementById("W2").innerHTML.replace(/\[\d+\//,"["+linecount+"/");	
					}
					if (name === "bottom-left") {
						document.getElementById("L1").innerHTML = document.getElementById("L1").innerHTML.replace(/\[\d+\//,"["+linecount+"/");	
					}
					if (name === "bottom-right") {
						document.getElementById("L2").innerHTML = document.getElementById("L2").innerHTML.replace(/\[\d+\//,"["+linecount+"/");	
					}
					// saving size for inputs and outputs
					localStorage.setItem(name, newtext);
				}
				function empty (){
					document.getElementById("top-left").value = "";
					document.getElementById("top-right").value = "";
					document.getElementById("bottom-left").value = "";
					document.getElementById("bottom-right").value = "";
					document.getElementById("output").value = "";
					localStorage.removeItem("top-left");
					localStorage.removeItem("top-right");
					localStorage.removeItem("bottom-left");
					localStorage.removeItem("bottom-right");
					localStorage.removeItem("output");
				}
			</script>
		</head>
		<body>
			<h1> Double Elimination Pairings Constructor </h1>
			<div><a href="https://jakilutra.github.io/Seasonals/" id="home">Home</a> | Progression Extractor | <b>Pairings Constructor</b></div>
			<div class="div-inline">
				<h4 id="W1"><b><small>Left/Top</small> Winner Bracket <small>Winners</small> Pairings [0/8]</b></h4>
				<textarea onkeyup="tidy(this.name, this.value);" name= "top-left" id="top-left" class="tarea" cols="50" placeholder="Copy and paste text from the bracketmaker directly."></textarea>
			</div>
			<div class="div-inline">
				<h4 id="W2"><b><small>Right/Bottom</small> Winner Bracket <small>Winners</small> Pairings [0/8]</b></h4>
				<textarea onkeyup="tidy(this.name, this.value);" name= "top-right" id="top-right" class="tarea" cols="50" placeholder="Copy and paste text from the bracketmaker directly."></textarea>
			</div>
			<br/>
			<div class="div-inline">
				<h4 id="L1"><b><small>Left/Top</small> Loser Bracket <small>Winners</small> Pairings [0/8]</b></h4>
				<textarea onkeyup="tidy(this.name, this.value);" name= "bottom-left" id="bottom-left" class="tarea" cols="50" placeholder="Copy and paste text from the bracketmaker directly."></textarea>
			</div>
			<div class="div-inline">
				<h4 id="L2"><b><small>Right/Bottom</small> Loser Bracket <small>Winners</small> Pairings [0/8]</b></h4>
				<textarea onkeyup="tidy(this.name, this.value);" name= "bottom-right" id="bottom-right" class="tarea" cols="50" placeholder="Copy and paste text from the bracketmaker directly."></textarea>
			</div>
			<br/>
			<div class='div-inline'>
				<label>Theme</label>
				<select id="themechange" onchange="changeTheme(this.value);">
					<option value="DeepDark">Deep Dark</option>
					<option value="IceBlue">Ice Blue</option>
					<option value="MalachtiteGreen">Malachtite Green</option>
					<option value="PhloxPurple">Phlox Purple</option>
					<option value="ScarletRed">Scarlet Red</option>
					<option value="StandardSilver">Standard Silver</option>
					<option value="SunnyOrange" selected>Sunny Orange</option>
				</select>
				<label class="small"><b>Size</b></label>
				<select id="scaler" class="small" onchange="scale(this.value);">
					<option value="1"selected>1.0 ×</option>
					<option value="1.5">1.5 ×</option>
				</select>
				<select id="size" class="small" onchange="modifySize(this.value);">
					<option id="8" value="8">8</option>
					<option id="16" value="16">16</option>
					<option id="32" value="32">32</option>
					<option id="64" value="64" selected>64</option>
					<option id="128" value="128">128</option>
					<option id="256" value="256">256</option>
					<option id="512" value="512">512</option>
				</select>
				<label class="small"><b>Round</b></label>
				<select id="parity" class="small" onchange="changeParity(this.value);">
					<option value="even" selected>Even</option>
					<option value="odd">Odd</option>
				</select>
				<select id="round" class="small" onchange="saveRound(this.value);">
					<option id="2" value="2" selected>2</option>
					<option id="4" value="4">4</option>
					<option id="6" value="6">6</option>
					<option id="1000" value="8">8</option>
				</select>
				<label class="small"><b>Method</b></label>
				<select id="method" class="small" onchange="saveMethod(this.value);">
					<option value="Stack">Stack [A1 vs B1] (suboptimal)</option>
					<option value="Odd-even" selected>Odd-even [A1 vs B2] (optimal)</option>
				</select>
			</div>
			<br/>
			<input type="checkbox" id="@on" value="@on" onchange="atSave();" checked>
			<label for="reverse" class="small">@ On/Off</label>
			<button id="button" type="button">Construct Pairings</button>
			<input type="checkbox" id="reverse" value="reverse" onchange="reversal()">
			<label for="reverse" class="small">Reverse</label>
			<button id="empty" type="button" onclick="empty();">🗑 Empty</button>
			<div>
				<textarea onkeyup="tidy(this.name, this.value);" name= "output" class="tarea" id="output" cols="100" placeholder="Merged output will be displayed here." readonly></textarea>
			</div>
		</body>	
	</html>
